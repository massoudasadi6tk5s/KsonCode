(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{432:function(t,e,i){},433:function(t,e,i){},991:function(t,e,i){"use strict";var a=i(432);i.n(a).a},992:function(t,e,i){"use strict";var a=i(433);i.n(a).a},993:function(t,e,i){"use strict";i.r(e);i(165),i(255),i(150);var a=i(144),s=(i(199),i(146)),n=(i(232),["stroke","stroke-width","stroke-opacity","fill","fill-opacity","_tempId","_isImport"]),o={name:"EditPopup",components:{XdhMapPopup:s.v},props:{position:{type:Array,default:function(){return[0,0]}},offset:{type:Array,default:function(){return[0,0]}},show:{type:Boolean,default:!1}},data:function(){return{editProp:{},editKey:"",addItem:{key:"",value:""},isAdd:!1}},computed:{},watch:{show:function(t){t?this.$refs.popup.show():this.$refs.popup.hide()}},methods:{setEdit:function(t){n.find(function(e){return e===t})||(this.editKey=t)},addItemBlur:function(){this.addItem.key&&this.addItem.value&&(this.editProp[this.addItem.key]=this.addItem.value,this.addItem.key="",this.addItem.value="",this.isAdd=!1)},addHandle:function(){this.isAdd=!0},saveHandle:function(){this.$emit("on-save",Object(a.a)({},this.editProp)),this.$refs.popup.hide()},deleteHandle:function(){this.$emit("on-delete",this.editProp._tempId)},setProps:function(t){this.editProp=Object(a.a)({},t)},definePropDel:function(t){return n.findIndex(function(e){return e===t})<0},removeKeyHandle:function(t){var e={};for(var i in this.editProp)i!==t&&(e[i]=this.editProp[i]);this.editProp=e}},created:function(){},mounted:function(){this.show||this.$refs.popup.hide()},beforeDestroy:function(){}},r=(i(991),i(16)),d=Object(r.a)(o,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("xdh-map-popup",{ref:"popup",attrs:{position:t.position,offset:t.offset,title:"属性编辑","close-on-click":!1,width:"300px"}},[i("div",{staticClass:"properties-table"},[i("div",{staticClass:"head row"},[i("div",{staticClass:"label"},[t._v("属性")]),t._v(" "),i("div",{staticClass:"value"},[t._v("值")])]),t._v(" "),i("div",{staticClass:"body"},[t._l(t.editProp,function(e,a){return i("div",{directives:[{name:"show",rawName:"v-show",value:"_tempId"!==a&&"_isImport"!==a,expression:"key !== '_tempId' && key !== '_isImport'"}],key:a,staticClass:"row"},[i("div",{staticClass:"label"},[t._v(t._s(a))]),t._v(" "),i("div",{staticClass:"value"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.editKey!==a,expression:"editKey !== key"}],class:{show:!0,changed:e!==t.editProp[a]},on:{click:function(e){return t.setEdit(a)}}},[t._v(t._s(e))]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.editKey===a,expression:"editKey === key"}],staticClass:"edit"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.editProp[a],expression:"editProp[key]"}],attrs:{type:"text"},domProps:{value:t.editProp[a]},on:{blur:function(e){t.editKey=""},input:function(e){e.target.composing||t.$set(t.editProp,a,e.target.value)}}})])]),t._v(" "),t.definePropDel(a)?i("span",{staticClass:"iconfont",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.removeKeyHandle(a)}}},[t._v("")]):t._e()])}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isAdd,expression:"isAdd"}],staticClass:"row"},[i("div",{staticClass:"label"},[i("div",{staticClass:"edit"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.addItem.key,expression:"addItem['key']"}],attrs:{type:"text"},domProps:{value:t.addItem.key},on:{blur:t.addItemBlur,input:function(e){e.target.composing||t.$set(t.addItem,"key",e.target.value)}}})])]),t._v(" "),i("div",{staticClass:"value"},[i("div",{staticClass:"edit"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.addItem.value,expression:"addItem['value']"}],attrs:{type:"text"},domProps:{value:t.addItem.value},on:{blur:t.addItemBlur,input:function(e){e.target.composing||t.$set(t.addItem,"value",e.target.value)}}})])])])],2)]),t._v(" "),i("div",{staticClass:"btn-wrap"},[i("button",{staticClass:"add",on:{click:t.addHandle}},[t._v("添加")]),t._v(" "),i("button",{staticClass:"save",on:{click:t.saveHandle}},[t._v("保存")]),t._v(" "),i("button",{staticClass:"delete",on:{click:t.deleteHandle}},[t._v("删除")])])])},[],!1,null,"8a13849a",null).exports,l=function(t){var e=t.toLowerCase();if(e&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){if(4===e.length){for(var i="#",a=1;a<4;a+=1)i+=e.slice(a,a+1).concat(e.slice(a,a+1));e=i}for(var s=[],n=1;n<7;n+=2)s.push(parseInt("0x"+e.slice(n,n+2)));return"RGB("+s.join(",")+")"}return e},c=i(224),p={stroke:"#555555","stroke-width":2,"stroke-opacity":1,fill:"#555555","fill-opacity":.5},u=function(t){var e=t.fill||"#555555",i=t.stroke||"#555555",a=l(e),n=a.substring(0,a.length-1)+",".concat(t["fill-opacity"]||.5,")"),o=l(i),r=o.substring(0,o.length-1)+",".concat(t["stroke-opacity"]||1,")");return Object(s.E)({className:"Style",fill:{className:"Fill",color:n},stroke:{className:"Stroke",color:r,width:t["stroke-width"]||2}})},h={mixins:[{data:function(){return{dragable:!1,dragCtrl:null,areaSelect:null,selectFeatures:[],otherFeatures:[]}},methods:{dragCtrlRegister:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new s.b(t,e)},areaSelectRegister:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new s.a(t,e,i)},boxStartHandle:function(){var t=this;this.selectFeatures.forEach(function(e){e.setStyle(t._Style({}))}),this.selectFeatures=[]},boxEndHandle:function(t){var e=[];this.editPol.forEach(function(i){var a=i.getGeometry().getInteriorPoint().getCoordinates();t.areaGeo.intersectsCoordinate(a)&&(i.setStyle(Object(s.E)({className:"Style",fill:{className:"Fill",color:"rgba(250,0,0,0.5)"},stroke:{className:"Stroke",color:"red",width:1}})),e.push(i))}),this.selectFeatures=e},dragDownHandle:function(t,e){var i=t.get("_tempId");this.isInSelets(i)&&(this.startCoord=Object(c.a)(e.coordinate),this.otherFeatures=this.selectFeatures.filter(function(t){return t.get("_tempId")!==i}))},dragMoveHandle:function(t,e){if(this.otherFeatures.length){var i=e.coordinate[0]-this.startCoord[0],a=e.coordinate[1]-this.startCoord[1];this.otherFeatures.forEach(function(t){t.getGeometry().translate(i,a)}),this.startCoord[0]=e.coordinate[0],this.startCoord[1]=e.coordinate[1]}},dragUpHandle:function(t,e){this.startCoord=[],this.otherFeatures=[]},cleanSelectHandle:function(){var t=this;this.selectFeatures.forEach(function(e){e.setStyle(t._Style({}))}),this.selectFeatures=[]},isInSelets:function(t){return!!this.selectFeatures.length&&this.selectFeatures.findIndex(function(e){return e.get("_tempId")===t})>=0}}}],components:{EditPopup:d,XdhMap:s.c,XdhMapPlacement:s.s,XdhMapGeo:s.i,XdhMapDraw:s.f},props:{},data:function(){return{map:null,mapComp:null,viewer:null,layerConfig:{Amap:{title:"高得地图",server:"http://webrd03.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}&lang=zh_cn"}},editPol:[],importOriginFeatures:[],state:{type:"FeatureCollection",features:[]},isUpload:!0,editing:!1,adding:!1,popupShow:!1,popupCenter:[],editFeature:null,outputString:""}},computed:{},methods:{mapReady:function(t,e){var i=this;this.map=t,this.mapComp=e,this.viewer=this.map.getView(),this.dragCtrl=this.dragCtrlRegister(this.mapComp,{featureDefine:function(t){if(i.dragable)return t}}),this.areaSelect=this.areaSelectRegister(this.map,this.mapComp,{class:"custom-drag-box"}),t.addInteraction(this.dragCtrl),t.addInteraction(this.areaSelect)},uploadChange:function(t){var e=this,i=t.target.files[0];if(i&&"application/json"===i.type){var a=new FileReader;a.readAsText(i),a.onload=function(t){e.isUpload=!0;var i=JSON.parse(t.currentTarget.result);e.state=i}}},drawDefineFn:function(t,e){this.importOriginFeatures.push(t);var i=t.clone();i.setProperties(Object(a.a)({},e.properties,p,{_tempId:(new Date).getTime(),_isImport:!0})),i.setStyle(u(e.properties)),this.$refs.map.addFeature(i),this.editPol.push(i),this.$refs.polygon.addFeatures([i]),t.setStyle(Object(s.E)({className:"Style",fill:{className:"Fill",color:"transparent"},stroke:{className:"Stroke",color:"transparent",width:1}}))},drawDone:function(t){var e=t[0].Feature.getGeometry().getInteriorPoint().getCoordinates();this.viewer.animate({center:e})},toEdit:function(){this.adding=!1,this.$refs.polygon.finish(),this.editing?this.$refs.polygon.finish():this.$refs.polygon.modify(),this.editing=!this.editing},toAdd:function(){this.editing=!1,this.$refs.polygon.finish(),this.adding?this.$refs.polygon.finish():this.$refs.polygon.draw(),this.adding=!this.adding},addDrawEnd:function(t){t.convert.feature.setProperties(Object(a.a)({},p,{_tempId:(new Date).getTime()})),t.convert.feature.setStyle(u({})),this.editPol.push(t.convert.feature)},featureClickHandle:function(t){if(!this.adding){this.editing&&this.$refs.polygon.finish();var e=this.$refs.map.getFeatureAtPixel(t.pixel);if(e){this.popupShow=!0,this.popupCenter=t.convert.coordinate,this.editFeature=e,console.log("feature",e,e.get("_tempId"));var i=Object(a.a)({},e.getProperties());delete i.geometry,this.$refs.editPopup.setProps(i)}}},propertiesSaveHandle:function(t){var e=this;this.editFeature.getKeys().filter(function(t){return"geometry"!==t}).forEach(function(i){Object.keys(t).findIndex(function(t){return t===i})<0&&e.editFeature.unset(i)}),this.editFeature.setProperties(Object(a.a)({},t))},featureDeleteHandle:function(t){var e=null,i=-1;this.editPol.forEach(function(a,s){a.get("_tempId")===t&&(e=a,i=s)}),e.get("_isImport")?this.mapComp.removeFeature(e):this.$refs.polygon.remove(e),this.editPol.splice(i,1),this.editFeature=null,this.popupShow=!1,this.popupCenter=[]},saveEdit:function(t){var e=[],i=[],s={type:"FeatureCollection",features:t.map(function(t){var a=t.getProperties();return e.push(t.getGeometry().getType()),i.push(t.getGeometry().getCoordinates()),delete a.geometry,delete a._tempId,delete a._isImport,a}).map(function(t,s){return{type:"Feature",properties:Object(a.a)({},t),geometry:{type:e[s],coordinates:i[s]}}})};this.outputString=JSON.stringify(s),console.log(this.outputString)},saveOutput:function(){this.saveEdit(this.editPol);var t=document.createElement("a");t.download=+new Date+".txt",t.style.display="none";var e=new Blob([this.outputString]);t.href=URL.createObjectURL(e),document.body.appendChild(t),t.click(),document.body.removeChild(t)},clearAll:function(){this.$refs.polygon.clear(),this.state={type:"FeatureCollection",features:[]},this.editPol=[],this.dragable=!1,this.dragCtrl=null,this.areaSelect=null,this.selectFeatures=[],this.otherFeatures=[],this.isUpload=!0,this.editing=!1,this.adding=!1,this.popupShow=!1,this.popupCenter=[],this.editFeature=null,this.outputString=""},_Style:u},created:function(){},mounted:function(){}},f=(i(992),Object(r.a)(h,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{height:"500px"}},[i("xdh-map",{ref:"map",attrs:{type:"Amap",zoom:12,center:[113.4,23.06],"layer-config":t.layerConfig},on:{ready:t.mapReady,click:t.featureClickHandle,"on-boxstart":t.boxStartHandle,"on-boxend":t.boxEndHandle,"on-dragDown":t.dragDownHandle,"on-dragMove":t.dragMoveHandle,"on-dragUp":t.dragUpHandle}},[i("xdh-map-placement",{attrs:{placement:"right-bottom",margin:[10,10],theme:"light"}},[i("div",{staticClass:"edit-btn-wrap clearfix"},[i("div",{staticClass:"edit-btn",attrs:{title:"添加"},on:{click:t.toAdd}},[i("span",{staticClass:"iconfont"},[t._v("")]),t._v("\n          "+t._s(t.adding?"保存添加":"添加")+"\n        ")]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.editPol.length,expression:"editPol.length"}],staticClass:"edit-btn",attrs:{title:"添加"},on:{click:t.toEdit}},[i("span",{staticClass:"iconfont"},[t._v("")]),t._v("\n          "+t._s(t.editing?"保存编辑":"编辑")+"\n        ")]),t._v(" "),i("label",{staticClass:"edit-btn",attrs:{for:"uploadJson",title:"导入"}},[i("span",{staticClass:"iconfont"},[t._v("")]),t._v("\n          导入\n        ")]),t._v(" "),i("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"uploadJson"},on:{change:t.uploadChange}}),t._v(" "),t.editPol.length?i("div",{staticClass:"edit-btn",on:{click:t.saveOutput}},[i("span",{staticClass:"iconfont"},[t._v("")]),t._v("\n          输出\n        ")]):t._e()])]),t._v(" "),i("xdh-map-placement",{attrs:{placement:"left-bottom",margin:[10,10],theme:"light"}},[i("div",{staticClass:"edit-btn-wrap clearfix"},[i("div",{staticClass:"edit-btn",attrs:{title:"拖动"},on:{click:function(e){t.dragable=!t.dragable}}},[i("span",{staticClass:"iconfont"},[t._v("")]),t._v("\n          "+t._s(t.dragable?"拖动":"打开拖动")+"\n        ")]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.selectFeatures.length,expression:"selectFeatures.length"}],staticClass:"edit-btn",attrs:{title:"取消选择"},on:{click:t.cleanSelectHandle}},[t._v("\n          取消选择\n        ")])])]),t._v(" "),i("xdh-map-placement",{attrs:{placement:"left-top",margin:[10,10],theme:"light"}},[i("div",{staticClass:"edit-btn-wrap clearfix"},[i("div",{staticClass:"edit-btn",attrs:{title:"清空"},on:{click:t.clearAll}},[t._v("\n          刷新\n        ")])])]),t._v(" "),t.isUpload&&t.state.features.length?i("xdh-map-geo",{ref:"geo",attrs:{state:t.state,"draw-define":t.drawDefineFn},on:{ready:t.drawDone}}):t._e(),t._v(" "),i("xdh-map-draw",{ref:"polygon",attrs:{type:"Polygon"},on:{drawend:t.addDrawEnd}}),t._v(" "),i("edit-popup",{ref:"editPopup",attrs:{position:t.popupCenter,offset:[0,0],show:t.popupShow},on:{"on-save":t.propertiesSaveHandle,"on-delete":t.featureDeleteHandle}})],1)],1)},[],!1,null,null,null));e.default=f.exports}}]);
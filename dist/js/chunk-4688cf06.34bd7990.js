(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4688cf06"],{"1ed4":function(t,e,i){"use strict";var a=i("ad1a"),s=i.n(a);s.a},7445:function(t,e,i){var a=i("63b6"),s=i("5d6b");a(a.G+a.F*(parseInt!=s),{parseInt:s})},"7f40":function(t,e,i){"use strict";var a=i("bcd7"),s=i.n(a);s.a},ad1a:function(t,e,i){},b9e9:function(t,e,i){i("7445"),t.exports=i("584a").parseInt},bcd7:function(t,e,i){},c54f:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("example",[i("xdh-map",{ref:"map",attrs:{type:"Amap",zoom:12,center:[113.4,23.06],"layer-config":t.layerConfig},on:{ready:t.mapReady,click:t.featureClickHandle}},[t.isUpload&&t.state.features.length?i("xdh-map-geo",{ref:"geo",attrs:{state:t.state,"draw-define":t.drawDefineFn},on:{ready:t.drawDone}}):t._e(),i("xdh-map-placement",{attrs:{placement:"right-bottom",margin:[10,10],theme:"light"}},[i("div",{staticClass:"edit-btn-wrap clearfix"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.state.features.length,expression:"state.features.length"}],staticClass:"edit-btn",attrs:{title:"添加"},on:{click:t.toEdit}},[i("span",{staticClass:"iconfont"},[t._v("")]),t._v("\n          "+t._s(t.editing?"保存编辑":"编辑")+"\n        ")]),i("div",{staticClass:"edit-btn",attrs:{title:"添加"},on:{click:t.toAdd}},[i("span",{staticClass:"iconfont"},[t._v("")]),t._v("\n          "+t._s(t.adding?"保存添加":"添加")+"\n        ")]),i("div",{staticClass:"edit-btn",attrs:{title:"导出"},on:{click:t.saveJson}},[i("span",{staticClass:"iconfont"},[t._v("")]),t._v("\n          导出\n        ")]),i("label",{staticClass:"edit-btn",attrs:{for:"uploadJson",title:"导入"}},[i("span",{staticClass:"iconfont"},[t._v("")]),t._v("\n          导入\n        ")]),i("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"uploadJson"},on:{change:t.uploadChange}})])]),i("xdh-map-draw",{ref:"polygon",attrs:{type:"Polygon"},on:{drawstart:t.drawStartHandle,drawend:t.addDrawEnd}}),i("edit-popup",{attrs:{position:t.popupCenter,offset:[0,0],show:t.popupShow,target:t.editTarget},on:{"on-save":t.propertiesSaveHandle}})],1)],1)},s=[],o=(i("20d6"),i("f499")),n=i.n(o),r=(i("ac6a"),i("6c7b"),i("e814")),d=i.n(r),l=function(t){var e=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,i=t.toLowerCase();if(i&&e.test(i)){if(4===i.length){for(var a="#",s=1;s<4;s+=1)a+=i.slice(s,s+1).concat(i.slice(s,s+1));i=a}for(var o=[],n=1;n<7;n+=2)o.push(d()("0x"+i.slice(n,n+2)));return"RGB("+o.join(",")+")"}return i},p=i("3a0d"),c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("xdh-map-popup",{ref:"popup",attrs:{position:t.position,offset:t.offset,title:"属性编辑","close-on-click":!1,width:"300px"}},[i("div",{staticClass:"properties-table"},[i("div",{staticClass:"head row"},[i("div",{staticClass:"label"},[t._v("属性")]),i("div",{staticClass:"value"},[t._v("值")])]),i("div",{staticClass:"body"},[t._l(t.editProp,function(e,a){return i("div",{key:a,staticClass:"row"},[i("div",{staticClass:"label"},[t._v(t._s(a))]),i("div",{staticClass:"value"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.editKey!==a,expression:"editKey !== key"}],class:{show:!0,changed:e!==t.target.properties[a]},on:{click:function(e){return t.setEdit(a)}}},[t._v(t._s(e))]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.editKey===a,expression:"editKey === key"}],staticClass:"edit"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.editProp[a],expression:"editProp[key]"}],attrs:{type:"text"},domProps:{value:t.editProp[a]},on:{blur:function(e){t.editKey=""},input:function(e){e.target.composing||t.$set(t.editProp,a,e.target.value)}}})])])])}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isAdd,expression:"isAdd"}],staticClass:"row"},[i("div",{staticClass:"label"},[i("div",{staticClass:"edit"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.addItem["key"],expression:"addItem['key']"}],attrs:{type:"text"},domProps:{value:t.addItem["key"]},on:{blur:t.addItemBlur,input:function(e){e.target.composing||t.$set(t.addItem,"key",e.target.value)}}})])]),i("div",{staticClass:"value"},[i("div",{staticClass:"edit"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.addItem["value"],expression:"addItem['value']"}],attrs:{type:"text"},domProps:{value:t.addItem["value"]},on:{blur:t.addItemBlur,input:function(e){e.target.composing||t.$set(t.addItem,"value",e.target.value)}}})])])])],2)]),i("div",{staticClass:"btn-wrap"},[i("button",{staticClass:"add",on:{click:t.addHandle}},[t._v("添加")]),i("button",{staticClass:"save",on:{click:t.saveHandle}},[t._v("保存")])])])},u=[],f=(i("7514"),i("5176")),h=i.n(f),v=["stroke","stroke-width","stroke-opacity","fill","fill-opacity"],m={name:"EditPopup",props:{position:{type:Array,default:function(){return[0,0]}},offset:{type:Array,default:function(){return[0,0]}},show:{type:Boolean,default:!1},target:{type:Object,default:function(){return{geometry:null,properties:{}}}}},data:function(){return{editProp:h()({},this.target.properties),editKey:"",addItem:{key:"",value:""},isAdd:!1}},computed:{},watch:{target:function(t){this.editProp=h()({},t.properties)},show:function(t){t?this.$refs.popup.show():this.$refs.popup.hide()}},methods:{setEdit:function(t){v.find(function(e){return e===t})||(this.editKey=t)},addItemBlur:function(){this.addItem.key&&this.addItem.value&&(this.editProp[this.addItem.key]=this.addItem.value,this.addItem.key="",this.addItem.value="",this.isAdd=!1)},addHandle:function(){this.isAdd=!0},saveHandle:function(){this.$emit("on-save",{id:this.target.id,geometry:this.target.geometry,properties:this.editProp}),this.$refs.popup.hide()}},created:function(){},mounted:function(){this.show||this.$refs.popup.hide()},beforeDestroy:function(){}},g=m,y=(i("1ed4"),i("2877")),w=Object(y["a"])(g,c,u,!1,null,"5be77d83",null),C=w.exports,b=function(t){var e=t["fill"]||"#555555",i=t["stroke"]||"#555555",a=l(e),s=a.substring(0,a.length-1)+",".concat(t["fill-opacity"]||.5,")"),o=l(i),n=o.substring(0,o.length-1)+",".concat(t["stroke-opacity"]||1,")");return Object(p["b"])({className:"Style",fill:{className:"Fill",color:s},stroke:{className:"Stroke",color:n,width:t["stroke-width"]||2}})},k={components:{EditPopup:C},data:function(){return{map:null,viewer:null,isUpload:!1,state:{type:"FeatureCollection",features:[]},formattedState:{type:"FeatureCollection",features:[]},editing:!1,editPol:[],adding:!1,popupCenter:[0,0],popupShow:!1,editTarget:{geometry:null,properties:{}},layerConfig:{Amap:{title:"高得地图",server:"http://webrd03.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}&lang=zh_cn"}}}},methods:{uploadChange:function(t){var e=this,i=t.target.files[0];if(i&&"application/json"===i.type){var a=new FileReader;a.readAsText(i),a.onload=function(t){e.isUpload=!0;var i=JSON.parse(t.currentTarget.result);e.state.features.length?(e.editPol=[],e.state.features=e.state.features.concat(i.features)):e.state=i}}},toEdit:function(){this.adding=!1,this.$refs.polygon.finish(),this.editing?(this.$refs.polygon.finish(),this.saveEdit(this.editPol)):this.$refs.polygon.modify(),this.editing=!this.editing},saveEdit:function(t){var e=this.state.features;t.forEach(function(t,i){var a=t.getGeometry().getCoordinates(),s=e[i].geometry;s.coordinates=a})},toAdd:function(){this.editing=!1,this.$refs.polygon.finish(),this.saveEdit(this.editPol),this.adding?this.$refs.polygon.finish():this.$refs.polygon.draw(),this.adding=!this.adding},saveJson:function(){this.state.features.length?this.adding||this.editing?alert("请先保存当前改动"):console.log(n()(this.state)):alert("当前未有图形")},drawStartHandle:function(t){console.log(t)},addDrawEnd:function(t){this.editPol.push(t.feature),this.state.features.push({type:"Feature",properties:{stroke:"#555555","stroke-width":2,"stroke-opacity":1,fill:"#555555","fill-opacity":.5},geometry:{type:"Polygon",coordinates:t.feature.getGeometry().getCoordinates()}}),t.feature.setStyle(b({}))},featureClickHandle:function(t){if(!this.adding){var e=this.$refs.map.getFeatureAtPixel(t.pixel);e&&(this.popupShow=!0,this.popupCenter=e.getGeometry().getInteriorPoint().getCoordinates(),this.editTarget=e.getProperties())}},propertiesSaveHandle:function(t){var e=this.editPol.findIndex(function(e){return e.ol_uid===t.id});this.editPol[e].set("properties",t.properties),this.state.features[e].properties=t.properties},drawDefineFn:function(t,e){var i=t.clone();i.set("properties",e.properties),i.set("id",i.ol_uid),i.setStyle(b(e.properties)),this.$refs.map.addFeature(i),this.$refs.polygon.addFeatures([i]),this.editPol.push(i),t.setStyle(Object(p["b"])({className:"Style",fill:{className:"Fill",color:"transparent"},stroke:{className:"Stroke",color:"transparent",width:1}}))},drawDone:function(t){console.log("features");var e=t[0].Feature.getGeometry().getInteriorPoint().getCoordinates();this.viewer.animate({center:e})},mapReady:function(t,e){this.map=t,this.viewer=this.map.getView()}},mounted:function(){}},x=k,P=(i("7f40"),Object(y["a"])(x,a,s,!1,null,"93e8ec20",null));e["default"]=P.exports},e814:function(t,e,i){t.exports=i("b9e9")}}]);
//# sourceMappingURL=chunk-4688cf06.34bd7990.js.map